(()=>{"use strict";var e={504:(e,t)=>{},227:(e,t)=>{t.e=void 0,t.e="_internal_tb_telemetry_broker"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}(()=>{class e extends Error{constructor(e,t){super(e),this.message=e,this.originalError=t,this.name=this.constructor.name,t&&(this.stack+="\nCaused by: "+t.stack)}}class t extends e{constructor(e,t){super(e),this.message=e,this.metadata=t}}class r extends e{constructor(e,t){super(e),this.message=e,this.metadata=t}}class o extends e{}const s=new Map([["ap-southeast-6","ap-southeast-6.prod.tangerinebox.console.aws.a2z.com"],["us-isof-south-1","us-isof-south-1.prod.tangerinebox.console.aws.a2z.com"],["us-iso-west-1","us-iso-west-1.prod.tangerinebox.console.c2s-a2z.ic.gov"],["eu-north-1","eu-north-1.prod.tangerinebox.console.aws.a2z.com"],["me-south-1","me-south-1.prod.tangerinebox.console.aws.a2z.com"],["cn-north-1","cn-north-1.prod.tangerinebox.console.aws.a2z.org.cn"],["ap-southeast-7","ap-southeast-7.prod.tangerinebox.console.aws.a2z.com"],["ap-south-1","ap-south-1.prod.tangerinebox.console.aws.a2z.com"],["eu-west-3","eu-west-3.prod.tangerinebox.console.aws.a2z.com"],["ap-southeast-3","ap-southeast-3.prod.tangerinebox.console.aws.a2z.com"],["us-east-2","us-east-2.prod.tangerinebox.console.aws.a2z.com"],["af-south-1","af-south-1.prod.tangerinebox.console.aws.a2z.com"],["us-iso-east-1","us-iso-east-1.prod.tangerinebox.console.c2s-a2z.ic.gov"],["eu-west-1","eu-west-1.prod.tangerinebox.console.aws.a2z.com"],["me-central-1","me-central-1.prod.tangerinebox.console.aws.a2z.com"],["us-isob-west-1","us-isob-west-1.prod.tangerinebox.console.sc2s-a2z.sgov.gov"],["eu-central-1","eu-central-1.prod.tangerinebox.console.aws.a2z.com"],["sa-east-1","sa-east-1.prod.tangerinebox.console.aws.a2z.com"],["ap-east-1","ap-east-1.prod.tangerinebox.console.aws.a2z.com"],["ap-south-2","ap-south-2.prod.tangerinebox.console.aws.a2z.com"],["us-east-1","us-east-1.prod.tangerinebox.console.aws.a2z.com"],["ap-northeast-2","ap-northeast-2.prod.tangerinebox.console.aws.a2z.com"],["ap-northeast-3","ap-northeast-3.prod.tangerinebox.console.aws.a2z.com"],["ap-southeast-5","ap-southeast-5.prod.tangerinebox.console.aws.a2z.com"],["us-isob-east-1","us-isob-east-1.prod.tangerinebox.console.sc2s-a2z.sgov.gov"],["eu-west-2","eu-west-2.prod.tangerinebox.console.aws.a2z.com"],["us-isof-east-1","us-isof-east-1.prod.tangerinebox.console.aws.a2z.com"],["us-northeast-1","us-northeast-1.prod.tangerinebox.console.aws.a2z.com"],["ap-southeast-4","ap-southeast-4.prod.tangerinebox.console.aws.a2z.com"],["eu-south-1","eu-south-1.prod.tangerinebox.console.aws.a2z.com"],["eu-isoe-west-1","eu-isoe-west-1.prod.tangerinebox.console.aws.a2z.com"],["ap-northeast-1","ap-northeast-1.prod.tangerinebox.console.aws.a2z.com"],["us-gov-east-1","us-gov-east-1.prod.tangerinebox.console.aws.a2z.com"],["us-gov-west-1","us-gov-west-1.prod.tangerinebox.console.aws.a2z.com"],["us-west-2","us-west-2.prod.tangerinebox.console.aws.a2z.com"],["mx-central-1","mx-central-1.prod.tangerinebox.console.aws.a2z.com"],["us-west-1","us-west-1.prod.tangerinebox.console.aws.a2z.com"],["ap-southeast-1","ap-southeast-1.prod.tangerinebox.console.aws.a2z.com"],["ap-southeast-2","ap-southeast-2.prod.tangerinebox.console.aws.a2z.com"],["il-central-1","il-central-1.prod.tangerinebox.console.aws.a2z.com"],["ap-east-2","ap-east-2.prod.tangerinebox.console.aws.a2z.com"],["ca-central-1","ca-central-1.prod.tangerinebox.console.aws.a2z.com"],["ca-west-1","ca-west-1.prod.tangerinebox.console.aws.a2z.com"],["eu-south-2","eu-south-2.prod.tangerinebox.console.aws.a2z.com"],["cn-northwest-1","cn-northwest-1.prod.tangerinebox.console.aws.a2z.org.cn"],["eu-central-2","eu-central-2.prod.tangerinebox.console.aws.a2z.com"]]),i=["csp.hci.ic.gov","amazonaws.com.cn","c2s.ic.gov","amazonaws.com","sc2s.sgov.gov","cloud.adc-e.uk","amazonaws.com"];const a="aws-userInfo",c="aws-userInfo-signed";let u=function(e){return e.SERVICE="service",e.SERVICE_SUB_SECTION="serviceSubSection",e.SERVICE_CONSOLE_PAGE="serviceConsolePage",e.VARIANT="variant",e}({});class l{constructor(){var e,t,n;e=this,n=()=>"undefined"!=typeof window&&"function"==typeof window?.panorama&&window?.panorama?.enabled,(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t="isPanoramaAvailable"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.metaTagContentCache=this.parseTangerineBoxMetaTag()}static getInstance(){return this.metaDataProviderInstance||(this.metaDataProviderInstance=new l),this.metaDataProviderInstance}getMetaTagContent(){return this.metaTagContentCache}getTelemetryConfig(){const e=this.getTelemetryEndpoint();let t;if(this.shouldUseTelemetrySubtenancy()){if(!this.userInfoSignedCookieCache&&(this.userInfoSignedCookieCache=this.parseCookie(c),!this.userInfoSignedCookieCache))throw new Error(`No '${c}' cookie.`);t=`Bearer ${this.userInfoSignedCookieCache}`}else{if(!this.userInfoCookieCache&&(this.userInfoCookieCache=this.parseCookie(a),!this.userInfoCookieCache))throw new Error(`No '${a}' cookie.`);const e=this.getMetaTagContent(),n=e?.telemetry?.authToken;"string"==typeof n&&(t=function(e,t,n){const r={authToken:e,cookies:{[t]:n}};return btoa(encodeURIComponent(JSON.stringify(r)))}(n,a,this.userInfoCookieCache))}return{endpoint:e,authHeader:t}}shouldUseTelemetrySubtenancy(){const e=this.parseMetaTag("awsc-session-data"),t=JSON.parse(e||"{}").infrastructureRegion;return!["us-iso-east-1","us-iso-west-1","us-isob-east-1"].includes(t)}getConsoleTelemetryToken(){const e=this.parseMetaTag("tbt-data");if(e)try{const t=JSON.parse(e).telemetryToken;return"string"==typeof t?t:void 0}catch(e){return}}getTelemetryEndpoint(){const e=this.getMetaTagContent(),t=e?.telemetry?.endpoint;if("string"==typeof t)return t;const n=Array.from(s.keys()),r=this.determineConsoleRegion(n);return`https://telemetry.cell-0.${s.get(r)}/telemetry`}determineConsoleRegion(e){const t=[()=>{const e=this.parseMetaTag("awsc-session-data"),t=JSON.parse(e||"{}").infrastructureRegion;if("string"==typeof t)return t},()=>this.parseMetaTag("awsc-mezz-region"),()=>new URLSearchParams(window?.location?.search).get("region"),()=>{const e=window?.location?.hostname,t=e?.split(".")[0];return t}];for(const n of t){const t=n();if(t&&e.includes(t))return t}throw new Error("Cannot determine region for telemetry endpoint.")}getTrackerEventContext(){return{callerCategory:this.parseCookie("metrics-req-cat")||"customer",location:"undefined"!=typeof window?window.location.href:"nodejs",requestId:"undefined"!=typeof window&&this.parseMetaTag("awsc-proxy-request-id")||"unknown"}}parseTangerineBoxMetaTag(){const e=this.parseMetaTag("tb-data");if(e)try{return JSON.parse(e)}catch(e){return}}parseMetaTag(e){const t=document.querySelector(`meta[name='${e}']`);if(t)return t.content}parseCookie(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.cookie).match(`${e}=([^;]*)`);if(t&&t[1])return t[1]}readCommonAttribute(e){if(!this.isPanoramaAvailable())throw new o("Could not read attribute");const t=window?.panorama?.q?.trackerDictionary?.cf?.readCommonAttribute;return t&&"function"==typeof t?t()[e]:void 0}}var d;function h(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m{constructor(e,t,n){this.window=e,this.telemetryToken=t,this.broker=n;const r=this.broker.register({telemetryToken:this.telemetryToken,source:"page-inline-script"});this.window.addEventListener("error",(e=>{!e||this.isDOMEvent(e)||this.isExtensionError(e.filename)||this.isErrorToIgnore(e.message)||this.broker.addEvent({tenantId:r,event:{type:"unhandled-error",timestamp:new Date,version:"page_inline_script",content:this.buildTrackerEventContent(e)}})}),!0)}isDOMEvent(e){return"Event"===e.constructor?.name}isExtensionError(e){try{return!!e&&/eval|debugger|[a-zA-Z]*-extension/i.test(e)}catch(e){return!1}}isErrorToIgnore(e){try{return!!e&&m.ERRORS_TO_IGNORE.indexOf(e)>=0}catch(e){return!1}}buildTrackerEventContent(e){const t={};if(t.eventClass=e.constructor?.name??"unknown",e.detail){const n=JSON.stringify(e.detail);t.detail=n.slice(0,Math.min(n.length,m.MAX_EVENT_DETAIL_SIZE))}return e.message&&(t.message=e.message),e.filename&&(t.filename=e.filename),e.lineno&&(t.lineNumber=e.lineno),e.colno&&(t.columnNumber=e.colno),e.error&&e.error.stack&&(t.stack=e.error.stack),e.target&&e.target.tagName&&(t.tagName=e.target.tagName),t}}d=m,h(m,"MAX_PAYLOAD_SIZE",65536),h(m,"MAX_EVENT_DETAIL_SIZE",.75*d.MAX_PAYLOAD_SIZE),h(m,"ERRORS_TO_IGNORE",["ResizeObserver loop limit exceeded","ResizeObserver loop completed with undelivered notifications.","Script error."]);class p{constructor(e){var t,n,r;t=this,r=[],(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(n="queue"))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,this.comparator=e?.comparator,this.maxSize=e?.maxSize}get size(){return this.queue.length}get isEmpty(){return 0===this.queue.length}add(){this.isAbleToFit(arguments.length)||this.queue.splice(-arguments.length,this.queue.length-arguments.length),this.queue.push(...arguments),this.prioritize()}isAbleToFit(e){return void 0===this.maxSize||this.maxSize>=this.size+e}remove(e){const t=Math.min(this.queue.length,e);return this.queue.splice(0,t)}peek(){return this.queue[0]}prioritize(){this.comparator&&this.queue.sort(this.comparator)}}class g{constructor(e){this.cb=e}notify(e){this.cb(e)}}var f=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},v=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},b=function(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)},y=function(e,t,n){var r;return function(o){t.value>=0&&(o||n)&&(t.delta=t.value-(r||0),(t.delta||void 0===r)&&(r=t.value,e(t)))}},w=-1,T=function(){return"hidden"===document.visibilityState?0:1/0},E=function(){v((function(e){var t=e.timeStamp;w=t}),!0)},S=function(){return w<0&&(w=T(),E(),b((function(){setTimeout((function(){w=T(),E()}),0)}))),{get firstHiddenTime(){return w}}},k=(new Date,{});function x(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=e=>Math.random()*Math.min(10,2**e)*100;class P{constructor(e){this.jsonReplacer=e}async call(e){const n=new Date;for(let o=0;o<=(e.maxRetries??4);o++){o&&C(o);try{const t=await this.callWithFetch(e,o);if(!((r=t.status)>=500||429===r))return{finalHttpStatusCode:t.status,data:t.data,retries:o,startTimestamp:n,latencyMillseconds:(new Date).getTime()-n.getTime(),maxRetriesExceeded:!1}}catch(r){if(o>=(e.maxRetries??4)&&r instanceof Error)throw new t(r.message,{finalHttpStatusCode:500,retries:o,code:r.metadata.code,startTimestamp:n,latencyMillseconds:(new Date).getTime()-n.getTime(),maxRetriesExceeded:!0})}}var r;throw new t("Too many retries",{finalHttpStatusCode:500,retries:e.maxRetries??4,startTimestamp:n,code:"MaxRetriesExceeded",latencyMillseconds:(new Date).getTime()-n.getTime(),maxRetriesExceeded:!0})}async callWithFetch(e,t){const n={method:e.method,headers:{"X-Retries":`${t}`,...e.headers},keepalive:e.keepalive??!1};if(void 0!==e.timeout&&e.timeout>0){const r=new AbortController;setTimeout((()=>r.abort()),e.timeout+t*(e.timeoutIncreasePerRetry||0)),n.signal=r.signal}"GET"!==e.method.toUpperCase()&&(n.body=this.createBody(e));try{const r=await fetch(e.url,n),o=r?.headers?.get("Content-Type");return o&&/application\/json/.test(o)?{data:await r.json(),retries:t,status:r.status}:{data:await r.text(),retries:t,status:r.status}}catch(e){throw e instanceof Error&&"AbortError"===e.name?new r("Request timeout",{code:"RequestTimeout",finalHttpStatusCode:500,retries:t}):new r("Request encountered an error",{code:"RequestFailed",finalHttpStatusCode:500,retries:t})}}createBody(e){const t=e.data;return t?"string"==typeof t?t:"object"==typeof t?JSON.stringify(t,this.jsonReplacer):String(t):null}}function z(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){return e.timestamp===t.timestamp?0:e.timestamp<t.timestamp?-1:1}class R{constructor(e,t){z(this,"httpClient",new P(R.errorReplacer)),z(this,"tenantQueueMap",new Map),z(this,"tenantQueueToStartRemoving",void 0),this.dataParser=t,this.endpoint=e.endpoint,this.authorizationHeader=e.authorizationHeader,this.maxEventsInChunk=e?.maxEventsInChunk??100,this.maxPayloadSizePerChunk=e?.maxPayloadSizePerChunk??524288,this.maxQueueSize=e?.maxQueueSize??1e4}getOrCreateQueueForTenant(e){const t=this.tenantQueueMap.get(e);if(void 0===t){const t=new p({comparator:(e,t)=>function(e,t){return"error"===e.type&&"error"===t.type?I(e,t):"error"===e.type?-1:"error"===t.type?1:I(e,t)}(e.event,t.event),maxSize:this.maxQueueSize});return this.tenantQueueMap.set(e,t),t}return t}get queueSize(){return Array.from(this.tenantQueueMap.values()).map((e=>e.size)).reduce(((e,t)=>e+t))}hasEvents(){return Array.from(this.tenantQueueMap.values()).some((e=>!e.isEmpty))}addEventContext(e){let t={...e,...this.dataParser.getTrackerEventContext()};try{t=this.addPageInformation(t)}catch(e){}return t}addEvent(e,t,n){const r=this.addEventContext(t);this.getOrCreateQueueForTenant(e).add({event:r,telemetryTokens:n})}publish(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{events:o,tokens:s}=this.getEventsToPublish(this.maxEventsInChunk,n?65536:this.maxPayloadSizePerChunk);if(0===o.length)e();else if(this.dataParser.shouldUseTelemetrySubtenancy()){const i={events:o,tokens:s};this.sendChunk(i,e,t,n,r)}else{const i=this.dataParser.getConsoleTelemetryToken(),a=s.findIndex((e=>e===i));if(-1===a)return void e();const c={events:o.filter((e=>e.tokenRefs.includes(a))).map((e=>{const{tokenRefs:t,...n}=e;return n}))};this.sendChunk(c,e,t,n,r)}}getEventsToPublish(e,t){const n=[],r=[],o=Array.from(this.tenantQueueMap.entries());if(void 0!==this.tenantQueueToStartRemoving){const e=o.findIndex((e=>{let[t]=e;return t===this.tenantQueueToStartRemoving}));o.push(...o.splice(0,e))}let s;for(;o.length>0;){const[i,a]=o.shift();if(n.length===e){s=s??i;break}if(a.isEmpty)continue;const{event:c,telemetryTokens:u}=a.peek(),l=r.length,d={...c,tokenRefs:u.map((e=>{const t=r.findIndex((t=>t===e));return-1===t?(r.push(e),r.length-1):t}))};0===n.length||JSON.stringify({events:n.concat(d)}).length<=t?(n.push(d),a.remove(1),o.push([i,a])):(s=s??i,r.splice(l))}return this.tenantQueueToStartRemoving=s,{events:n,tokens:r}}flush(){this.hasEvents()&&this.publish((()=>this.flush()),(()=>this.flush()),!0,!0)}sendChunk(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this.authorizationHeader)return void t();const s={timeout:3e4,method:"POST",headers:{Authorization:this.authorizationHeader,"Content-Type":"application/json","X-Remaining-Events":this.queueSize.toString(),"X-Publish-Type":o?"flushed":"scheduled"},url:this.endpoint,data:e,keepalive:r};this.httpClient.call(s).then(t).catch(n)}static errorReplacer(e,t){if(t instanceof Error){const e={};return Object.getOwnPropertyNames(t).forEach((n=>{e[n]=t[n]})),t.stack&&(e.stack=t.stack),e}if(t instanceof ErrorEvent){const e={};return t.message&&(e.message=t.message),t.filename&&(e.filename=t.filename),t.lineno&&(e.lineNumber=t.lineno),t.colno&&(e.columnNumber=t.colno),t.error&&t.error.stack&&(e.stack=t.error.stack),e}return t}addPageInformation(e){return{...e,subSection:this.dataParser.readCommonAttribute(u.SERVICE_SUB_SECTION)||void 0,page:this.dataParser.readCommonAttribute(u.SERVICE_CONSOLE_PAGE)||void 0}}}function M(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class O{constructor(e,t,n){M(this,"scheduledInvocation",null),M(this,"scheduledInvocationTime",0),M(this,"isPublishing",!1),M(this,"isListenerRegistered",!1),this.eventPublisher=e,this.tenantRegister=t,this.consoleTelemetryToken=n,this.tenantRegister.addObserver(new g((e=>this.addUnloadListener(e)))),this.scheduleWithNextTick()}schedule(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;if(!this.isPublishing){if(this.scheduledInvocation){if(this.scheduledInvocationTime<this.now()+e)return;clearTimeout(this.scheduledInvocation),this.scheduledInvocation=null}this.scheduledInvocation=setTimeout((()=>{this.isPublishing=!0,this.scheduledInvocation=null,this.eventPublisher.publish((()=>{this.isPublishing=!1,this.eventPublisher.hasEvents()?this.scheduleSubsequent():this.scheduleWithNextTick()}),(()=>{this.isPublishing=!1,this.scheduleWithNextTick()}))}),e),this.scheduledInvocationTime=this.now()+e}}scheduleWithNextTick(){this.schedule(2e3)}scheduleSubsequent(){this.schedule(500)}scheduleError(){this.schedule(1e3)}now(){return"undefined"!=typeof performance&&"function"==typeof performance.now?performance.now():Date.now()}addUnloadListener(e){this.isListenerRegistered||e.telemetryToken!==this.consoleTelemetryToken||"weblib-v1"!==e.source&&"weblib-v2"!==e.source||"undefined"!=typeof window&&(window.addEventListener("beforeunload",(()=>this.eventPublisher.flush())),this.isListenerRegistered=!0)}}class N{constructor(){this.idToPropsMap=new Map,this.propsToIdMap=new Map,this.observers=[]}set(e,t){this.idToPropsMap.set(e,t),this.propsToIdMap.set(this.serialize(t),e),this.observers.forEach((e=>e.notify(t)))}hasTenantId(e){return this.idToPropsMap.has(e)}getProps(e){return this.idToPropsMap.get(e)}getTenantId(e){const t=this.serialize(e);return this.propsToIdMap.get(t)}addObserver(e){this.observers.push(e)}serialize(e){return JSON.stringify({t:e.telemetryToken,pt:e.parentTelemetryToken,s:e.source})}}const _={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let L;const q=new Uint8Array(16);function j(){if(!L&&(L="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!L))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return L(q)}const A=[];for(let e=0;e<256;++e)A.push((e+256).toString(16).slice(1));const D=function(e,t,n){if(_.randomUUID&&!t&&!e)return _.randomUUID();const r=(e=e||{}).random||(e.rng||j)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return A[e[t+0]]+A[e[t+1]]+A[e[t+2]]+A[e[t+3]]+"-"+A[e[t+4]]+A[e[t+5]]+"-"+A[e[t+6]]+A[e[t+7]]+"-"+A[e[t+8]]+A[e[t+9]]+"-"+A[e[t+10]]+A[e[t+11]]+A[e[t+12]]+A[e[t+13]]+A[e[t+14]]+A[e[t+15]]}(r)};n(504);var U=n(227);const Q=l.getInstance().getConsoleTelemetryToken(),H=new class{constructor(){var e,t,n;e=this,t="tenantRegister",n=new N,(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;const r=l.getInstance().getTelemetryConfig();this.eventPublisher=new R({endpoint:r.endpoint,authorizationHeader:r.authHeader},l.getInstance()),this.requestScheduler=new O(this.eventPublisher,this.tenantRegister,l.getInstance().getConsoleTelemetryToken())}register(e){const t=this.tenantRegister.getTenantId(e);if(void 0!==t)return t;let n;do{n=D().split("-")[0]}while(this.tenantRegister.hasTenantId(n));return this.tenantRegister.set(n,{telemetryToken:e.telemetryToken,parentTelemetryToken:e.parentTelemetryToken,source:e.source}),n}addEvent(e){const t=this.tenantRegister.getProps(e.tenantId);if(void 0===t)return;const n=[t.telemetryToken];e.publicEvent&&void 0!==t.parentTelemetryToken&&n.push(t.parentTelemetryToken),this.attachBrokerVersion(e.event),this.eventPublisher.addEvent(e.tenantId,e.event,n),"error"===e.event.type&&this.requestScheduler.scheduleError()}dangerouslyFlushEvents(){this.eventPublisher.flush()}addRegistrationObserver(e){this.tenantRegister.addObserver(e)}attachBrokerVersion(e){const t=[e.version,"(broker: 1.0.527.0#15f2969e)"].join(" ");e.version=t}};Q&&"undefined"!=typeof window&&(new class{constructor(e,t,n){var r,o,s;r=this,s=0,(o=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(o="numberOfReportedEvents"))in r?Object.defineProperty(r,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[o]=s,this.document=e,this.telemetryToken=t,this.broker=n;const i=this.broker.register({telemetryToken:this.telemetryToken,source:"page-inline-script"});this.document.addEventListener("securitypolicyviolation",(t=>{++this.numberOfReportedEvents>10||this.broker.addEvent({tenantId:i,event:{type:"csp-violation",timestamp:new Date,version:"page_inline_script",content:{},cspViolation:{documentURI:t.documentURI||e.location.href,effectiveDirective:t.effectiveDirective||"unknown",originalPolicy:t.originalPolicy||"unknown",disposition:t.disposition||"enforce",statusCode:t.statusCode||200,blockedURI:t.blockedURI,sourceFile:t.sourceFile,sample:t.sample,lineNumber:t.lineNumber,columnNumber:t.columnNumber}}})}))}}(window.document,Q,H),new m(window,Q,H),new class{constructor(e,t){x(this,"fallbackQueue",new p({maxSize:1e3})),x(this,"isNewWebLibRegistered",!1),this.telemetryToken=e,this.broker=t,this.tenantId=this.broker.register({telemetryToken:this.telemetryToken,source:"page-inline-script"}),this.broker.addRegistrationObserver(new g((e=>this.flushFallbackQueue(e)))),this.emitPageMetrics((e=>this.processPageEvent(e))),this.emitPerformanceMetrics(["resource","navigation","measure"],(e=>this.processPerformanceMetrics(e)))}emitPageMetrics(e){!function(e,t){var n,r=S(),o=f("LCP"),s=function(e){var t=e.startTime;t<r.firstHiddenTime&&(o.value=t,o.entries.push(e),n())},i=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}}("largest-contentful-paint",s);if(i){n=y(e,o,t);var a=function(){k[o.id]||(i.takeRecords().map(s),i.disconnect(),k[o.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,a,{once:!0,capture:!0})})),v(a,!0),b((function(r){o=f("LCP"),n=y(e,o,t),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-r.timeStamp,k[o.id]=!0,n(!0)}))}))}))}}(e)}emitPerformanceMetrics(e,t){if(window&&"PerformanceObserver"in window){const n=new PerformanceObserver(t);try{e.forEach((e=>n.observe({type:e,buffered:!0})))}catch{n.observe({entryTypes:e})}}}processCustomMeasureMetrics(e){e.name.length>0&&e.name.match("^[A-Za-z]")&&this.enqueue({tenantId:this.tenantId,event:{type:"custom-measure-metric",timestamp:new Date,version:"page_inline_script",content:{},customMeasureMetric:{name:e.name,timeToCustomMark:e.duration}}})}processNavigationMetrics(e){this.enqueue({tenantId:this.tenantId,event:{type:"navigation-metric",timestamp:new Date,version:"page_inline_script",content:{},navigationMetric:{startTime:e.startTime,duration:e.duration,initiatorType:e.initiatorType,domComplete:e.domComplete,domContentLoadedEventEnd:e.domContentLoadedEventEnd,domContentLoadedEventStart:e.domContentLoadedEventStart,domInteractive:e.domInteractive,loadEventEnd:e.loadEventEnd,loadEventStart:e.loadEventStart,redirectCount:e.redirectCount,redirectStart:e.redirectStart,requestStart:e.requestStart,responseStart:e.responseStart,type:e.type,unloadEventEnd:e.unloadEventEnd,unloadEventStart:e.unloadEventStart}}})}processPageEvent(e){this.enqueue({tenantId:this.tenantId,event:{type:"page-metric",timestamp:new Date,version:"page_inline_script",content:{},pageMetric:{timeToLoadLargestContentfulPaint:e.value}}})}processResourceMetrics(e){e.name.includes("/p/log/")||e.name.includes("panoramaroute")||e.name.includes("telemetry")||e.name.startsWith("data:")||e.name.startsWith("blob:")||e.name.match(new RegExp(`^https://polly\\.[a-z0-9-]+\\.${i.map((e=>e.replace(/\./g,"\\."))).join("|")}/v1/speech\\?}`))||this.enqueue({tenantId:this.tenantId,event:{type:"resource-metric",timestamp:new Date,version:"page_inline_script",content:{},resourceMetric:{url:e.name,startTime:e.startTime,duration:e.duration,initiatorType:e.initiatorType,nextHopProtocol:e.nextHopProtocol,fetchStart:e.fetchStart,domainLookupStart:e.domainLookupStart,domainLookupEnd:e.domainLookupEnd,connectStart:e.connectStart,connectEnd:e.connectEnd,requestStart:e.requestStart,responseStart:e.responseStart,responseEnd:e.responseEnd,transferSize:e.transferSize,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize}}})}isMeasureEntry(e){return"measure"===e.entryType}isNavigationEntry(e){return"navigation"===e.entryType}isResourceEntry(e){return"resource"===e.entryType}processPerformanceMetrics(e){for(const t of e.getEntries())this.isMeasureEntry(t)?this.processCustomMeasureMetrics(t):this.isNavigationEntry(t)?this.processNavigationMetrics(t):this.isResourceEntry(t)&&this.processResourceMetrics(t)}enqueue(e){this.isNewWebLibRegistered?this.broker.addEvent(e):this.fallbackQueue.add(e)}flushFallbackQueue(e){this.isNewWebLibRegistered||this.telemetryToken!==e.telemetryToken||"weblib-v1"!==e.source&&"weblib-v2"!==e.source||(this.fallbackQueue.remove(this.fallbackQueue.size).forEach((e=>this.broker.addEvent(e))),this.isNewWebLibRegistered=!0)}}(Q,H)),window[U.e]=H})()})();
//# sourceMappingURL=index.js.map